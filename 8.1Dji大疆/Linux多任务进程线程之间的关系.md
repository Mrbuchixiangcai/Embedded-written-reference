##  Linux的多任务, 多进程, 多线程

### [进程和程序的区别](https://blog.csdn.net/weixin_36194037/article/details/82390068)

| 区别      | 程序         | 进程                 |
| --------- | ------------ | -------------------- |
| 组成      | 代码+数据；  | 代码+数据+堆栈+pcb； |
| 存储方式  | 永久存储     | 占时存储与内存       |
| 静态/动态 | 静态的概念   | 动态的概念           |
| 并发      | 无并发概念   | 有并发的概念         |
| 关系      | 对应多个进程 | 可以执行多个程序     |

1. 什么是程序？
   - 是完成特定任务的一系列**指令的集合**
   - 是指编译好的**二进制文件**，在磁盘上；不占用系统资源（cpu,内存,设备，锁）
2. 什么是进程?
   - **用户**角度：进程是程序的一次**动态**执行过程；
   - **内核角度**：进程是分配cpu，内存等系统资源的**基本单位**；
   - 都有自己的**状态**；都有自己的虚拟地址空间；
   - 在内存中执行且占用系统资源；

### 进行，线程，协程：执行任务的方法

| 区别         | 进程                       | 线程                                      | 协程                           |
| ------------ | -------------------------- | ----------------------------------------- | ------------------------------ |
| 主要区别     | 资源分配的最小单位         | 程序执行的最小单位<br />CPU的最小调度单位 | 完全是由程序所控制             |
| 组成         | 拥有多个线程               | 共享地址空间, 访问相同的数据              | 多个函数，子程序组成           |
| 可执行       | 程序执行时的一个实例(大)   | 线程是进程的一个执行流(小)                | **极高的执行效率**             |
| 保存状态信息 | PCB                        | TCB Thread control block                  | 通过栈进行切换，无需上下文切换 |
| 页表         | 地址空间改变, 切换当前页表 | 共享地址空间, 不用切换页表                |                                |
| 内存空间     | 独立的内存空间             | **独立栈**空间(局部变量)                  |                                |
| 影响         | 进程间不影响               | 一个线程死掉就等于**整个**进程死掉        |                                |

### 进程和线程

2. 进程的创建和执行
   + 必须分配给它独立的地址空间，
   + 建立众多的数据表来维护它的代码段、堆栈段和数据段
3. 线程的描述
   + 线程是进程的一个**执行流**，是CPU调度和分派的基本单位，
   + 它是比进程更小的能独立运行的基本单位;
   
   ![thread_status.png](/8.1Dji大疆/photo/thread_status.png)

### 线程 VS 协程

1. 协程的特点：
   + 比线程更加轻量级的存在，协程不是被操作系统内核所管理，而完全是**由程序所控制**（也就是在用户态执行）
   + 类似于程序里面的函数；
   + 协程在子程序内部是可中断的，然后转而执行别的子程序，在适当的时候再返回来接着执行
2. 协程的特点在于是一个线程执行，那和多线程比，协程有何优势？
   + **极高的执行效率**：
     + 因为**子程序切换不是线程切换，而是由程序自身控制**，
     + **没有线程切换的开销**，和多线程比，线程数量越多，协程的性能优势就越明显；
   + **不需要多线程的锁机制**：
     + 因为只有一个线程，也不存在同时写变量冲突，
     + **在协程中控制共享资源不加锁**，只需要**判断状态**就好了，所以执行效率比多线程高很多。

###  使用多线程原因

1. 多任务并发的优势
   + 进程创建 :  花费较多的时间维护其内存空间
   + 线程创建:  只需要在执行的时候, 分配栈空间和局部变量空间就行;
2. 通信实现
   + 进程间: 数据的传递只能通过**通信**的方式进行;
   + 线程间: 同步和互斥机制就能实现;
3. 多内核
   + 多线程程序作为一种多任务、并发的工作方式
   + 多线程技术: 将耗时长的操作（time consuming）单独置于一个新的线程;
   + OS **使得线程数不大于CPU数目时，不同的线程运行于不同的CPU上**。

### 线程共享的资源有哪些？

1. 一个进程中的所有线程：共享该进程的地址空间
2. **堆：**是大家共有的空间，分全局堆和局部堆。
3. 