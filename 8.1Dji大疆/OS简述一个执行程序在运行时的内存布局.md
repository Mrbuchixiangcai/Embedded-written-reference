## OS简述一个执行程序在运行时的内存布局

1. C程序中内存空间的组成?

   + 由五个部分组成代码段(.text)、数据段(.data)、BSS段(.bss)，堆和栈

   + 编译的时候由**编译器分配**: 代码段(.text)、数据段(.data)、BSS段(.bss)

   + 程序运行的时候由**系统分配**: 堆和栈 

     | 什么时候分配 | 内存空间分布 | 功能                                                         |
     | ------------ | ------------ | ------------------------------------------------------------ |
     | 编译时分配   | BSS段        | 存放 程序中**未初始化**的全局变量和静态变量;  只在**运行**时占用内存; |
     |              | data         | 存放程序中**已初始化**的全局变量和静态变量的一块内存区域     |
     |              | code         | 存放程序**执行代码**的一块内存区域;                          |
     | 运行是分配   | 堆heap       | 存放 : 进程运行中被**动态分配的内存段**                      |
     |              | 栈stack      | 存放: 程序**临时创建**的局部变量                             |

   

2. BSS段（bss segment）“Block Started bySymbol”“以符号开始的块”

   + 存放 : 程序中**未初始化**的全局变量和静态变量;
     + 未初始化: 没有显示赋值;
   + BSS段属于**静态内存分配**。 
     + BSS节不包含任何数据，只是简单的维护开始和结束的地址，即总大小
     + 以便内存区能在运行时分配并被有效地清零
   + 运行是占空内存: 
     + **不占用磁盘**空间而只在运行的时候占用内存空间，
     + 所以如果全局变量和静态变量未初始化那么其可执行文件要小很多。

3. 数据段(.data)

   + 存放: 程序中**已初始化**的全局变量和静态变量的一块内存区域
   + 数据段属于静态内存分配
     + 只读数据段 : 字符串常量等
     + 读写数据段

4. 代码段(.text)

   + 存放: 程序**执行代码**的一块内存区域;
     + 这部分区域的大小在程序运行前就已经确定
     + 并且内存区域通常属于**只读**

5. 堆（heap）

   + 存放 : 进程运行中被**动态分配的内存段**，它的大小并不固定，可动态扩张或缩减
   + 堆内存的变化:
     + 调用malloc等函数分配内存时: 新分配的内存就被动态添加到堆上（堆被扩张）
     + free等函数释放内存时: 被释放的内存从堆中被剔除（堆被缩减）

6. 栈(stack)

   + 存放: 程序**临时创建**的局部变量，也就是说我们函数括弧“{}”中定义的变量
     + 但不包括static声明的变量: static意味着在**数据段**中存放变量
   + 作用
     + **函数被调用**: 其参数也会被压入发起调用的进程栈中; 并且待到调用结束后，函数的返回值也会被存放回栈中
     + 栈特别方便用来保存/恢复调用现场;
   + 栈的空间大小:
     + 栈空间是向下增长的，每个线程有一个自己的栈
     + 在linux上默认的大小是8M，可以用ulimit查看和修改;