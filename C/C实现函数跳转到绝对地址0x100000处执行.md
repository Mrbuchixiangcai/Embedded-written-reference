## [C语言实现程序跳转到绝对地址0x100000处执行](https://blog.csdn.net/weixin_33779515/article/details/86337160)

+ 将0x100000看做某一个函数的首地址，也就是函数名；

### 函数名代表首地址

1. 通过程序：打印函数的地址

   ```
   #include <stdio.h>
   void func(void)
   {
       printf("hello.\n");
   }
   int main()
   {
       // (1) 他们的结果是一样的
       printf("func = %d\n",func);
       printf("&func = %d\n",&func);
   }
   ```

2. &运算符本来的意义

   + 它要求其操作数是一个**对象**，但**函数名不是对象**（函数是一个对象）
   + c/c++标准的制定者出于对象的概念已经有所发展的缘故，也承认了&func的合法性

3. 对于函数名：取址不取址都可以

   + // func是函数的首地址，它的类型是void ();

   + // &func表示一个指向函数void func(void)这个对象的**地址**（也就是指针），它的类型是void (*)()

### 函数指针的调用方法？

```
#include <stdio.h>
void func(void)
{
    printf("hello.\n");
}
int main()
{
  // (2)在调用一个函数的时候，也有两种方法
    // 定义一个函数指针，这个指针无返回值，无参数，指向fun函数
    void (*func_p)(void) = func;
    (*func_p)();    //调用函数时，加一个括号
    (func_p)();     //
    func_p();       //后面两者也是对的，只是不那么用
    func();


}
```

1. void * ：参数无返回值；

2. void (*)(void) : 定义一个函数指针，这个指针无返回值，无参数，指向fun函数

3. 可以通过**typedef**定义函数指针，简化代码表示

   ```
   typedef void (*convert)() ;  // typedef定义了一个函数指针；
       // (4) 能不能通过typedef来简化表达式
   {
   	puts("By typedef: ");
       convert func_pp = func;
       (func_pp)();
    }
   ```

### 使用函数调用，实现绝对地址的跳转

```
//(3)实现程序跳转到绝对地址0x100000处执行
    /* 	 void (*)(void); --> int * ;  //void *：是一个数据类型，返回值为空，参数为空；
     * 	( void (*)(void) ); --> ( int * );   //加了一个括号之后，代表强制类型转换
     * 	( void (*)(void) )0x100000;          //把0x100000强制转化为一个函数指针
     *	 ( *( void (*)(void) )0x100000 )();     // 第一种方式实现
     *	 ( ( void (*)(void) )0x100000 )();      // 第二种方式：就是调用这个函数，外层再加个括号，后面在加一对括号
    */
```

1. 当数据类型加上一个**括号**之后：类似于类型的**强制转换**；

2. 实现函数的调用：采用第二种方式，在调用这个函数，外层再加个括号，后面在加一对括号

   ```
   ( void (*)(void) )0x100000;          //把0x100000强制转化为一个函数指针； 整体就是一个函数指针；
    ( ( void (*)(void) )0x100000 )();      //函数指针的调用，外层再加个括号，后面在加一对括号；
   ```

### 几个误区

1. 两种错误的调用方式

   ```
    ( void(*) (void) )0x100000 ();		// 没有加外层括号
    *( (void(*) (void)0x100000) ) ();		// *号在整体之外；没见过*func(); 这么用的……
   ```

2. **总结：最外层不能是* ，必须是括号**

### [all code](/code/memory_visit.c)