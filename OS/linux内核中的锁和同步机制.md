## Linux 内核锁主要是自旋锁和信号量

| 区别       | 自旋锁     | 信号量--用户空间 | 信号量--内核空间 |
| ---------- | ---------- | ---------------- | ---------------- |
| 申请锁失败 | 忙循环等待 | 等待队列，睡眠   | 等待队列，睡眠   |
| ISR中      | 可以       | 不可以           | 不可以           |

+ 进程和ISR都要访问同一内核数据时：

  + 要在进程或者内核代码中申请自旋锁时：要**禁止中断**，避免死锁

  + ```
    spin_lock_irqsave;
    spin_unlock_irqstroe;	
    ```

### 自旋锁

```
spin_lock()				// 阻塞获取锁
spin_trylock()		//  得阻塞获取锁
spin_unlock()		//释放锁
```

### 内核信号量

1. 内核信号量：只能在内核中使用

   ```
   void down();		// 获取信号量，会导致睡眠；
   void up();				// 释放sem信号量，将信号量加1；
   ```

2. IPC信号量：只能在用户空间中使用

   ```
   sem_wait();		// 获取信号量，会导致睡眠；
   sem_post();		// 释放信号量，使得信号量加1
   ```
